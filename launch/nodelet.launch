<launch>
    <!-- Nodelet Manager -->
    <node pkg="nodelet" type="nodelet" name="camera_manager" args="manager" output="screen" />

    <!-- GStreamer Camera Nodelet -->
    <node pkg="nodelet" type="nodelet" name="gstreamer_cam_nodelet" args="load gstreamer_ros_bridge/GStreamerCam camera_manager" output="screen">
        <param name="camera_location" value="/dev/video0" />
        <param name="camera_width" value="1280" />
        <param name="camera_height" value="720" />
        <param name="camera_fps" value="60" />
        <param name="camera_format" value="BGR" />
        <param name="camera_topic" value="/camera/image_rect" />

        <!-- Uncomment one custom pipeline as needed -->
        <!-- Default GStreamer pipeline -->
        <!-- <param name="custom_pipeline" value= 
        "v4l2src device=/dev/video0 ! videoconvert ! videoscale ! video/x-raw,width=1280,height=720,framerate=60/1 !
        appsink name=sink sync=false" /> -->

        <!-- Jetson Nano Luxonis Minimal CPU pipeline -->
        <!-- <param name="custom_pipeline" value= 
            "v4l2src device=/dev/video0 ! 
            videoscale ! 
            video/x-raw,width=1280,height=720,framerate=60/1 ! 
            nvvidconv ! 
            video/x-raw(memory:NVMM),format=RGBA ! 
            nvvidconv ! 
            video/x-raw,format=RGBA ! 
            videoconvert ! 
            video/x-raw,format=BGR ! 
            appsink name=sink sync=false" /> -->

        <!-- Jetson Nano IMX219 pipeline -->
        <param name="custom_pipeline" value= 
        "nvarguscamerasrc sensor-mode=4 !
        video/x-raw(memory:NVMM),width=1280,height=720,format=NV12,framerate=30/1 !
        nvvidconv ! video/x-raw,format=RGBA,width=1280,height=720 !
        videoconvert ! video/x-raw,format=BGR !
        appsink name=sink sync=false" />

        <!-- Libcamera pipeline -->
        <!-- <param name="custom_pipeline" value= 
        "libcamerasrc ! videoconvert ! video/x-raw,format=BGR,width=1280,height=720,framerate=30/1 !
        appsink name=sink sync=false" /> -->
    </node>

    <node pkg="nodelet" type="nodelet" name="gstreamer_bridge_nodelet" args="load gstreamer_ros_bridge/GStreamerRosBridge camera_manager" output="screen">
        <!--params for gstreamer pipeline to peer (over udp)-->
        <param name="bitrate" value="1200"/>
        <param name="mtu" value="500"/>
        <param name="gst_width" value="1280"/>
        <param name="gst_height" value="720"/>
        <param name="gst_fps" value="30"/>
        <param name="gst_topic" value="/camera/image_rect"/>

        <!--target ip and port-->
        <param name="ip" value="100.64.0.1"/>
        <param name="port" value="5602"/>
    </node>
</launch>
